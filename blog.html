<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MyDraftly â€” Blog</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="wrap">
    <h1>MyDraftly â€” Blog</h1>
    <div id="list"></div>
  </div>

  <script>
    // ðŸ”§ Replace with your Supabase creds
    const SUPABASE_URL = 'https://YOUR_PROJECT.supabase.co';
    const SUPABASE_ANON_KEY = 'YOUR_ANON_KEY';

    async function loadPosts() {
      const list = document.getElementById('list');
      list.innerHTML = '<div class="card"><p class="small">Loading postsâ€¦</p></div>';
      try {
        const resp = await fetch(`${SUPABASE_URL}/rest/v1/posts?select=title,content,slug,created_at&order=created_at.desc`, {
          headers: {
            apikey: SUPABASE_ANON_KEY,
            Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
            'Content-Type': 'application/json'
          }
        });
        if (!resp.ok) throw new Error(await resp.text());
        const posts = await resp.json();
        if (!posts.length) {
          list.innerHTML = '<div class="card"><p class="small">No posts yet. Go to <a href="/index.html">Write</a>.</p></div>';
          return;
        }
        list.innerHTML = '';
        posts.forEach(p => {
          const d = new Date(p.created_at);
          const card = document.createElement('article');
          card.className = 'card';
          card.innerHTML = `
            <h2>${escapeHtml(p.title || '(Untitled)')}</h2>
            <p class="small">${d.toLocaleString()}</p>
            <div>${nl2br(escapeHtml(p.content || ''))}</div>`;
          list.appendChild(card);
        });
      } catch (e) {
        list.innerHTML = `<div class="card"><p class="small">Error: ${e.message}</p></div>`;
      }
    }
    function escapeHtml(s){return (s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[c]))}
    function nl2br(s){return (s||'').replace(/\n/g,'<br>')}
    loadPosts();
  </script>
</body>
</html>