<script>
  // ðŸ”§ Paste your Supabase creds:
  const SUPABASE_URL = 'https://YOUR_SUPABASE_URL.supabase.co';
  const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY';

  async function loadPosts() {
    const list = document.getElementById('list');
    list.innerHTML = '<div class="card"><p class="small">Loading postsâ€¦</p></div>';

    try {
      const resp = await fetch(
        `${SUPABASE_URL}/rest/v1/posts?select=title,content,slug,created_at&order=created_at.desc`,
        {
          headers: {
            apikey: SUPABASE_ANON_KEY,
            Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
            'Content-Type': 'application/json',
          },
        }
      );

      if (!resp.ok) {
        const err = await resp.text();
        throw new Error(err || 'Failed to load posts');
      }

      const posts = await resp.json();

      if (!posts.length) {
        list.innerHTML = '<div class="card"><p class="small">No posts yet. Go to <a href="/index.html">Write</a> to create one.</p></div>';
        return;
      }

      list.innerHTML = '';
      posts.forEach((p) => {
        const d = new Date(p.created_at);
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <h2>${escapeHtml(p.title || '(Untitled)')}</h2>
          <p class="small">${d.toLocaleString()}</p>
          <div>${nl2br(escapeHtml(p.content || ''))}</div>
        `;
        list.appendChild(card);
      });
    } catch (e) {
      console.error(e);
      list.innerHTML = `<div class="card"><p class="small">Error loading posts: ${e.message}</p></div>`;
    }
  }

  // Simple helpers to keep output safe & readable
  function escapeHtml(s) {
    return (s || '').replace(/[&<>"']/g, (c) => ({
      '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;',
    }[c]));
  }
  function nl2br(s) {
    return (s || '').replace(/\n/g, '<br>');
  }

  loadPosts();
</script>
